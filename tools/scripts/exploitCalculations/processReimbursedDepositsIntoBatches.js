// process_depositors.js
const fs = require('fs');



const poolTokenName = 'Dai'
const inputFileName = `reimbursedDeposits-${poolTokenName}PoolTUP-block-254085962.json`;
const batchSize = 300;

// Read the input JSON file
const rawData = fs.readFileSync(inputFileName);
let data = JSON.parse(rawData);
data = Object.fromEntries(Object.entries(data).filter(([_, v]) => v !== "0" && v !== "0.0"));

// Prepare arrays for addresses and balances
const addresses = [];
const balances = [];

// Process each depositor entry
for (const [address, balance] of Object.entries(data)) {
    addresses.push(address);
    balances.push(balance);
}

// Create batches and write to JSON files
const totalEntries = addresses.length;
let batchCount = 0;

for (let i = 0; i < totalEntries; i += batchSize) {
    const batchAddresses = addresses.slice(i, i + batchSize);
    const batchBalances = balances.slice(i, i + batchSize);
    const batchData = {
        depositorAddresses: batchAddresses,
        depositorBalances: batchBalances,
    };
    batchCount++;
    const outputFileName = `${poolTokenName}_depositors_batch_${batchCount}.json`;
    fs.writeFileSync(outputFileName, JSON.stringify(batchData, null, 2));
    console.log(`Batch ${batchCount} written to ${outputFileName}`);
}
